<?xml version="1.0"?>
<launch>
    <arg name="external_manager" default="false" />
    <arg name="manager" default="devices_manager" />
    <arg name="roomba" default="roomba1" />

    <node unless="$(arg external_manager)" pkg="nodelet" type="nodelet" name="$(arg manager)" args="manager" />
    <!-- theta s -->
    <group ns="theta_s">
        <node pkg="nodelet" type="nodelet" name="libuvc_camera"
                args="load libuvc_camera/driver $(arg manager)" >
            <param name="vendor" value="0x05ca"/>
            <param name="product" value="0x2711"/>
            <param name="serial" value=""/>
            <!-- If the above parameters aren't unique, choose the first match: -->
            <param name="index" value="0"/>

            <!-- Image size and type -->
            <param name="width" value="1280"/>
            <param name="height" value="720"/>
            <!-- choose whichever uncompressed format the camera supports: -->
            <param name="video_mode" value="mjpeg"/> <!-- or yuyv/nv12/mjpeg -->
            <param name="frame_rate" value="14"/>

            <param name="timestamp_method" value="start"/> <!-- start of frame -->
            <param name="camera_info_url" value="file:///tmp/cam.yaml"/>

            <param name="auto_exposure" value="3"/> <!-- use aperture_priority auto exposure -->
            <param name="auto_white_balance" value="false"/>
            <param name="frame_id" value="$(arg roomba)/theta_s" />
        </node>
    </group>

    <!-- dynamixel -->
    <arg name="usb_port" default="/dev/ttyUSB1" />
    <include file="$(find dynamixel_workbench_controllers)/launch/roomba_joint.launch" >
        <arg name="usb_port" default="$(arg usb_port)" />
    </include>
    <node pkg="roomba_dynamixel_controller" type="roomba_dynamixel_controller" name="roomba_dynamixel_controller" >
        <param name="execution_time" value="0.2" type="double" />
        <param name="offset_angle" value="0.00" type="double" />
    </node>

    <!-- realsense d455 -->
    <param name="/camera/aligned_depth_to_color/image_raw/compressed/format" value="png" />
    <param name="/camera/aligned_depth_to_color/image_raw/compressed/png_level" value="5" />
    <include file="$(find realsense2_camera)/launch/rs_rgbd.launch">
        <arg name="external_manager" default="true" />
        <arg name="manager" default="$(arg manager)" />
        <param name="filters" value="disparity,temporal" />
    </include>

    <!-- roomba -->
    <node name="roomba_500driver_meiji" pkg="roomba_500driver_meiji" type="main500" >
        <param name="serial_port" value="/dev/ttyUSB0" />
        <param name="publish_intensity" value="true" />
        <param name="publish_multiecho" value="false" />
    </node>

    <!-- hokuyo LiDAR -->
    <node name="urg_node" pkg="urg_node" type="urg_node" >
        <param name="ip_address" value="" />
        <param name="serial_port" value="/dev/ttyACM0" />
        <param name="publish_intensity" value="true" />
        <param name="publish_multiecho" value="false" />
    </node>

</launch>
