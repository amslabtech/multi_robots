<?xml version="1.0"?>
<launch>
    <arg name="external_manager" default="false" />
    <arg name="manager" default="devices_manager" />
    <arg name="roomba" default="roomba1" />

    <!-- theta s -->
    <group ns="theta_s">
        <node unless="$(arg external_manager)" pkg="nodelet" type="nodelet" name="$(arg manager)" args="manager" />
        <node pkg="nodelet" type="nodelet" name="libuvc_camera"
                args="load libuvc_camera/driver $(arg manager)" >
            <param name="vendor" value="0x05ca"/>
            <param name="product" value="0x2711"/>
            <param name="serial" value=""/>
            <param name="index" value="0"/>
            <param name="width" value="1280"/>
            <param name="height" value="720"/>
            <param name="video_mode" value="mjpeg"/>
            <param name="frame_rate" value="14"/>
            <param name="timestamp_method" value="start"/>
            <param name="frame_id" value="$(arg roomba)/theta_s" />
        </node>
    </group>

    <!-- dynamixel -->
    <arg name="usb_port" default="/dev/ttyUSB1" />
    <include file="$(find dynamixel_workbench_controllers)/launch/roomba_joint.launch" >
        <arg name="usb_port" default="$(arg usb_port)" />
        <arg name="roomba" default="$(arg roomba)" />
    </include>
    <node pkg="roomba_dynamixel_controller" type="roomba_dynamixel_controller" name="roomba_dynamixel_controller" >
        <remap from="/angle" to="dynamixel/angle" />
        <remap from="/dynamixel_workbench/joint_states" to="dynamixel_workbench/joint_states" />
        <remap from="/dynamixel_workbench/joint_trajectory" to="dynamixel_workbench/joint_trajectory" />
        <param name="execution_time" value="0.2" type="double" />
        <param name="offset_angle" value="0.00" type="double" />
        <param name="dynamixel_frame_id" value="$(arg roomba)/dynamixel" />
        <param name="base_link_frame_id" value="$(arg roomba)/base_link" />
    </node>

    <!-- realsense d455 -->
    <param name="camera/aligned_depth_to_color/image_raw/compressed/format" value="png" />
    <param name="camera/aligned_depth_to_color/image_raw/compressed/png_level" value="5" />
    <include file="$(find multi_robots)/launch/rs_rgbd.launch">
        <arg name="external_manager" value="$(arg external_manager)" />
        <arg name="manager" value="$(arg manager)" />
        <arg name="tf_prefix" value="$(arg roomba)/camera" />
        <arg name="filters" value="disparity,temporal" />
        <arg name="initial_reset" value="true" />
    </include>

    <!-- roomba -->
    <node name="roomba_500driver_meiji" pkg="roomba_500driver_meiji" type="main500" >
        <param name="ROBOT_FRAME" value="$(arg roomba)/base_link" />
        <param name="ODOM_FRAME" value="$(arg roomba)/odom" />
        <remap from="/roomba/control" to="roomba/control" />
        <remap from="/roomba/states" to="roomba/states" />
        <remap from="/roomba/odometry" to="roomba/odometry" />
    </node>

    <!-- hokuyo LiDAR -->
    <node name="urg_node" pkg="urg_node" type="urg_node" >
        <rosparam command="load" file="$(find multi_robots)/config/lidar/$(arg roomba)_lidar.yaml" />
        <param name="publish_intensity" value="true" />
        <param name="publish_multiecho" value="false" />
        <param name="frame_id" value="$(arg roomba)/laser" />
    </node>

    <!-- tf -->
    <node pkg="multi_robots_tf" type="static_roomba_tf2_broadcaster" name="static_roomba_tf2_broadcaster" >
        <param name="base_link_frame_id" value="$(arg roomba)/base_link" />
        <param name="lidar_frame_id" value="$(arg roomba)/laser" />
        <param name="thetas_frame_id" value="$(arg roomba)/theta_s" />
        <param name="dynamixel_frame_id" value="$(arg roomba)/dynamixel" />
        <param name="realsense_frame_id" value="$(arg roomba)/camera_link" />
        <rosparam command="load" file="$(find multi_robots_tf)/config/static_roomba_tf.yaml" />
    </node>
</launch>
